function myMapMenuCntrl(a){var b=document.createElement("div");b.id="cssmenu";for(var c=document.createElement("ul"),d=[{l:"Map Type",children:[{label:"Default Map",index:0},{label:"Satellite",index:1},{label:"Custom Map",index:2}]},{l:"Map Layers",children:[{label:"Cameras",index:0},{label:"Reader Locations",index:1},{label:"Link Segments",index:2}]},{l:"Info Items",children:[{label:"Legend",index:0},{label:"Disclaimer",index:1}]}],e=0;e<d.length;e++){var f=d[e];if(null!=f.l){var g=document.createElement("li"),h=document.createElement("a"),i=document.createElement("span");if(h.setAttribute("href","#"),i.innerHTML=f.l,g.appendChild(h),h.appendChild(i),c.appendChild(g),null!=f.children||0!=f.children){g.className="has-sub";var j=f.children,k=document.createElement("ul");g.appendChild(k);for(var l=0;l<j.length;l++){var m=j[l],n=document.createElement("li"),o=document.createElement("a"),p=document.createElement("span");o.setAttribute("href","#"),p.innerHTML=m.label,o.appendChild(p),n.appendChild(o),p.onclick=menuItemClick,l==j.length-1&&(n.className="last"),k.appendChild(n)}g.appendChild(k)}e==d.length-1&&(g.className="last")}}b.appendChild(c),b.style.margin="0px 0px 10px 10px",a.gmap.controls[a.position].push(b)}function showLinkPolylines(a){for(var b=0;b<mimLinks.length;b++)mimLinks[b].setMap(a)}function showReaderLocationMarkers(a){for(var b=0;b<readerLocations.length;b++)readerLocations[b].setMap(a)}function mapDesclaimer(a){var b=document.createElement("div"),c=document.createElement("div");c.id="disclaimerDiv";var d=document.createElement("div"),e=document.createElement("span"),f=document.createElement("span");e.innerHTML=a.message,f.id="disclaimerDateTime",f.innerHTML=moment().format("MMMM Do YYYY, h:mm:ss a"),d.appendChild(e),d.appendChild(f),c.appendChild(d),b.appendChild(c),c.className="disclaimer",e.className="disclaimerMsg",f.className="disclaimerDateTime",a.gmap.controls[a.position].push(b)}function mapLegend(a){var b=document.createElement("div"),c=document.createElement("div");c.id="legendDiv";var d=document.createElement("div"),e=document.createElement("div"),f=document.createElement("span"),g=[{itemName:"light",itemColor:"#32CD32",tt:"traffic is light and moving"},{itemName:"moderate",itemColor:"#FFDF00",tt:"traffic is moderate and moving"},{itemName:"moderate-heavy",itemColor:"#ffa500",tt:"traffic is approching capacity"},{itemName:"heavy",itemColor:"#CC3333",tt:"traffic is heavy and at/over capacity"},{itemName:"not enough sightings",itemColor:"#4E7AC7",tt:"there were not enough detector sightings to provide a confident travel time"},{itemName:"no data",itemColor:"#444444",tt:"there is no data available"}];f.innerHTML=a.legendTitle,d.className="legendHeader",d.appendChild(f);var h=document.createElement("ul");h.id="losLegendListUl",h.className="legendList";for(var i=0;i<g.length;i++){var j=g[i],k=document.createElement("li");k.style.display="inline-block",i==g.length-1?k.style.margin="0":k.style.margin="0 2px 0 0",null!=j.tt||""!=j.tt?k.title=j.tt:k.title=j.itemName;var l=document.createElement("div");l.className="legendColorBox",l.style.backgroundColor=j.itemColor,l.innerHTML=j.itemName,k.appendChild(l);var m=document.createElement("div");m.style.display="inline-block",m.style.verticalAlign="middle",m.style.color="#ffffff",m.className="noTxtSelect",k.appendChild(m),h.appendChild(k)}e.appendChild(h),c.appendChild(e),b.appendChild(c),c.className="legend",a.gmap.controls[a.position].push(b)}function PolylineInfoWindowControl(a){chartData=[];var b=document.createElement("div");b.id="chartWrapper",b.className="chartWrapper";var c=document.createElement("div");c.id="chartHeader",c.className="chartHeader";var d=document.createElement("div");d.id="chartContents",d.className="chartContents";var e=document.createElement("img");e.id="chartLoader",e.src=chartLoaderImg,e.style.margin="0 auto";var f="",g="",h=document.createElement("div");h.className="chartFooter";var i=document.createElement("div");i.className="historicalDataForm";var j=document.createElement("div");j.id="startDateWrapperDiv",j.className="historicalFormSections";var k=document.createElement("label");k.innerHTML="Start Date & Time:",k.for="startDate",k.className="formLabels";var l=document.createElement("input");l.id="startDate",l.type="date";var m=document.createElement("input");m.id="startTime",m.type="time",j.appendChild(k),j.appendChild(l),j.appendChild(m);var n=document.createElement("div");n.id="endDateWrapperDiv",n.className="historicalFormSections";var o=document.createElement("label");o.innerHTML="End Date & Time:",o.className="formLabels",o.for="endDate";var p=document.createElement("input");p.id="endDate",p.type="date";var q=document.createElement("input");q.id="endTime",q.type="time",n.appendChild(o),n.appendChild(p),n.appendChild(q),Modernizr.inputtypes.date||(m.style.visibility="hidden",q.style.visibility="hidden",$(l).datetimepicker({format:"YYYY-MM-DD HH:mm:ss",formatTime:"HH:mm",formatDate:"MM/DD/YYYY",maxDate:0}),$(p).datetimepicker({format:"YYYY-MM-DD HH:mm:ss",formatTime:"HH:mm",formatDate:"MM/DD/YYYY",maxDate:0}));var r=document.createElement("input");r.type="button",r.id="getHistoricalData",r.value="Get Historical Data",r.addEventListener("click",function(){Modernizr.inputtypes.date?(f=moment(l.value.toString()+" "+m.value.toString()).format("YYYY-MM-DD HH:mm:ss"),g=moment(p.value+" "+q.value).format("YYYY-MM-DD HH:mm:ss")):(f=l.value,g=p.value),null!=chart&&(chartData=[],chart.clear(),clearInterval(refreshLiveDataTimer),console.log("chart is not null")),proxy.getHistMidtownEzPassTT(a.lid0,a.lid1,1e4,f,g,new Async(onDataReceived,onDataFail)),d.appendChild(e)});var s=document.createElement("div");s.className="chartFooterSectionTitle",s.innerHTML="Historical Information",i.appendChild(s),i.appendChild(j),i.appendChild(n),i.appendChild(r);var t=document.createElement("div"),u=document.createElement("div"),v=document.createElement("div");t.className="chartFooterSection",u.className="chartFooterSection",v.className="chartFooterSection";var w=document.createElement("input");w.type="button",w.value="Get Live Data",w.addEventListener("click",function(){try{proxy.getLiveMidtownEzPassTT("x",a.lid0,a.lid1,1e4,new Async(onDataReceived,onDataFail)),refreshLiveDataTimer=setInterval(function(){var b=chartData[chartData.length-1].uid;proxy.getLiveMidtownEzPassTT(b,a.lid0,a.lid1,1e4,new Async(onDataReceived,onDataFail))},1e4)}catch(a){alert("error requesting data:"+a.message+"\n"+a.stack),alert(a.description),alert(a.details)}});var x=document.createElement("input");x.type="button",x.value="Clear Data";var y=document.createElement("input");y.type="button",y.value="Save Data",y.addEventListener("click",function(){if(0==chartData.length||null==chartData)showDialog("No Data to Download","There is no data to Download. Please request data to graph and try to download again");else try{for(var c,a=chartData,b=["uid","Date","time","travelTime"],d=[],e=0;e<a.length;e++)d.push(a[e].uid+","+moment(a[e].time).format("MM-DD-YY")+","+moment(a[e].time).format("HH:mm:ss")+","+a[e].tt);c=b.join(",")+"\r\n"+d.join("\r\n");var f=document.createElement("a"),g=new Blob(["\ufeff",c]),h=URL.createObjectURL(g);f.href=h,f.download="mim_data_"+moment().format("MM_DD_YY")+".csv",document.body.appendChild(f),f.click(),document.body.removeChild(f)}catch(a){showDialog("Error Downloading Data","There was an error downloading the data or creating the CSV file. Please try again")}}),x.addEventListener("click",function(){chartData=[],chart.clear(),clearInterval(refreshLiveDataTimer)}),t.appendChild(w),u.appendChild(x),v.appendChild(y),h.appendChild(i),h.appendChild(t),h.appendChild(v),h.appendChild(u);var z=document.createElement("div");return z.innerHTML=a.linkName,z.className="chartTitle",c.appendChild(z),b.appendChild(c),b.appendChild(d),b.appendChild(document.createElement("hr")),b.appendChild(h),b}function onDataReceived(a){if(0==chartData.length)chartData=a,createChart();else{for(var b=0;b<a.length;b++)dataSet.dataProvider.push(a[b]),chart.zoomOut();chart.validateData()}}function onDataFail(a){showDialog("Error Downloading Data","There was an error downloading data from the server.\n"+a.message)}function createChart(){chart=new AmCharts.AmStockChart,chart.addListener("rendered",function(){console.log("historical data chart is redenred:"+new Date)}),dataSet=new AmCharts.DataSet,chart.pathToImages="img/images/",chart.zoomOutOnDataSetChange=!0,dataSet.dataProvider=chartData,dataSet.fieldMappings=[{fromField:"tt",toField:"value"}],dataSet.categoryField="time";var a=new AmCharts.CategoryAxesSettings;a.minPeriod="fff",a.maxSeries=0,a.autoGridCount=!0,chart.categoryAxesSettings=a,dataSet.title="This is my dataset title",dataSet.color="#ff0000",chart.dataSets=[dataSet];var b=new AmCharts.StockPanel;chart.panels=[b];var c=new AmCharts.PanelsSettings;c.startDuration=1,chart.panelsSettings=c;var d=new AmCharts.StockGraph;d.animationPlayed=!1,d.valueField="value",d.type="line",d.lineAlpha=0,d.fillAlphas=0,d.bullet="round",d.bulletSize=4,d.title="this is my graph title",b.addStockGraph(d),chart.write("chartContents")}function showDialog(a,b){msg.title=a,msg.innerHTML=b,$(function(){$(msg).dialog({modal:!0,dialogClass:"jqueryDialog",show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300}})})}var msg=document.createElement("div");msg.id="msgDiv",msg.className="msg";var chartData,chart,dataSet,refreshLiveDataTimer,chartLoaderImg="img/loading51.gif";Date.parseDate=function(a,b){return moment(a,b).toDate()},Date.prototype.dateFormat=function(a){return moment(this).format(a)};var menuItemClick=function(b){switch(b.preventDefault(),b.stopPropagation(),b.target.innerHTML){case"Cameras":markerCluster?(markerCluster.clearMarkers(),console.log("markercluster length: "+myCameraMarkers.length),markerCluster=null):markerCluster=new MarkerClusterer(map,myCameraMarkers,{styles:cctvClusterStyle});break;case"Reader Locations":null==b.target.state||"on"==b.target.state?(showReaderLocationMarkers(null),b.target.state="off"):(showReaderLocationMarkers(map),b.target.state="on");break;case"Link Segments":null==b.target.state||"on"==b.target.state?(showLinkPolylines(null),b.target.state="off"):(showLinkPolylines(map),b.target.state="on");break;case"Disclaimer":var c=document.getElementById("disclaimerDiv");"visible"==c.style.visibility||""==c.style.visibility?c.style.visibility="hidden":c.style.visibility="visible";break;case"Legend":var c=document.getElementById("legendDiv");"visible"==c.style.visibility||""==c.style.visibility?c.style.visibility="hidden":c.style.visibility="visible";break;case"Default Map":map.setMapTypeId(google.maps.MapTypeId.ROADMAP);break;case"Satellite":map.setMapTypeId(google.maps.MapTypeId.SATELLITE);break;case"Custom Map":map.setMapTypeId("map_style");break;default:alert(b.target.innerHTML)}},CameraIW=function(a,b,c,d){var e=document.createElement("div");e.id="cameraInfoWindow",e.className="camIw";var f=document.createElement("div");f.className="camIwHeader";var g=document.createElement("diV");g.className="headerLine";var h=document.createElement("div");h.className="camIwTitle",h.innerHTML=a;var i=document.createElement("div");i.id="camIwCloseBtn",i.innerHTML="x",i.className="camIwCloseBtn",i.addEventListener("click",stopCameraInfoWindow),f.appendChild(g),g.appendChild(h),g.appendChild(i);var j=document.createElement("div");j.id="camIwContent",j.className="camIwContent";var k=document.createElement("div");k.id="camLoader",k.style.width="352px",k.style.height="240px",k.style.position="relative";var l=document.createElement("img");l.src="img/loading3.gif",l.style.position="absolute",l.style.top="50%",l.style.left="45%",k.appendChild(l);var m=document.createElement("img");m.id="myImg",m.className="myImg",m.src=b,m.alt="cctvImage",j.appendChild(m);var n=document.createElement("img");n.src=c,n.alt="agencyLogo",n.className="camLogo",j.appendChild(n);var o=document.createElement("div");return o.className="camIwFooter",e.appendChild(f),e.appendChild(j),e.appendChild(o),e};